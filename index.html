<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìß</text></svg>" />
  <title>Code Generator with Email Notification</title>
  
  <!-- Prism.js CSS for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    input, button {
      padding: 12px;
      margin: 10px 0;
      width: 100%;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    input:focus {
      outline: none;
      border-color: #007BFF;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    .feedback {
      margin: 15px 0;
      padding: 12px;
      border-radius: 6px;
      display: none;
      font-weight: 500;
    }
    .feedback.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .feedback.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .feedback.info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .status-section {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      border: 1px solid #c3e6cb;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 25px;
      color: #155724;
    }
    .status-section h3 {
      margin-top: 0;
    }
    .test-button {
      background-color: #28a745;
      margin-bottom: 10px;
    }
    .test-button:hover {
      background-color: #218838;
    }
    .code-container {
      margin: 20px 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: #2d3748;
    }
    .code-header {
      background: #2d3748;
      color: white;
      padding: 12px 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #4a5568;
    }
    .copy-button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      width: auto;
      margin: 0;
    }
    .copy-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .code-wrapper {
      position: relative;
      max-height: 400px;
      overflow-y: auto;
    }
    .code-wrapper pre {
      margin: 0 !important;
      border-radius: 0 !important;
      background: #2d3748 !important;
      font-size: 14px;
      line-height: 1.5;
      padding: 20px;
    }
    .code-wrapper code {
      font-family: 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
      color: #e2e8f0;
    }
    .form-container {
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 25px;
    }
    .empty-state {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 40px;
      background: #f8f9fa;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
    }
    .debug-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Monaco', monospace;
      font-size: 12px;
      max-height: 250px;
      overflow-y: auto;
      display: none;
      white-space: pre-wrap;
    }
    .error-details {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      color: #856404;
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è Code Generator + Email Notification</h2>
  
  <!-- Status Section -->
  <div class="status-section">
    <h3>‚úÖ EmailJS Configuration Status</h3>
    <p><strong>Public Key:</strong> gSzAYtERZ6iPLH_OV</p>
    <p><strong>Service ID:</strong> service_indlo7r</p>
    <p><strong>Template ID:</strong> template_2j9tqk7</p>
    <p id="initStatus">üîÑ Initializing EmailJS...</p>
    <button type="button" id="testEmailBtn" class="test-button">üß™ Test Email Configuration</button>
  </div>
  
  <div class="form-container">
    <form id="codeGeneratorForm">
      <label for="name">Your Name:</label>
      <input type="text" id="name" name="name" placeholder="Enter your name" required />
      
      <label for="email">Your Email:</label>
      <input type="email" id="email" name="email" placeholder="Enter your email" required />
      
      <button type="submit" id="generateBtn">üöÄ Generate Code & Send Email</button>
    </form>
  </div>
  
  <div id="feedback" class="feedback"></div>
  <div id="errorDetails" class="error-details" style="display: none;"></div>
  
  <h3>üìÑ Generated Code:</h3>
  <div id="codeContainer" class="code-container" style="display: none;">
    <div class="code-header">
      <span>üìÑ Generated JavaScript Code</span>
      <button class="copy-button" onclick="copyToClipboard()">üìã Copy</button>
    </div>
    <div class="code-wrapper">
      <pre><code id="generatedCode"></code></pre>
    </div>
  </div>
  
  <div class="empty-state" id="emptyState">
    <div>üéØ Your beautifully highlighted code will appear here...</div>
    <div style="margin-top: 10px; font-size: 14px;">Click "Generate Code & Send Email" to get started!</div>
  </div>
  
  <h3>üêõ Debug Information:</h3>
  <div id="debugInfo" class="debug-info"></div>
  <button type="button" id="toggleDebug">Show Debug Info</button>

  <!-- Prism.js JavaScript for syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

  <script type="module">
    // Import EmailJS
    let emailjs;
    try {
      const module = await import('https://cdn.jsdelivr.net/npm/@emailjs/browser@4/+esm');
      emailjs = module.default;
      debugLog('EmailJS module loaded successfully');
    } catch (error) {
      debugLog('Failed to load EmailJS module:', error);
      showErrorDetails('Failed to load EmailJS library. Please check your internet connection.');
    }
    
    // Your EmailJS Configuration
    const EMAILJS_CONFIG = {
      publicKey: 'gSzAYtERZ6iPLH_OV',
      serviceId: 'service_indlo7r',
      templateId: 'template_2j9tqk7'
    };
    
    let isEmailJSInitialized = false;
    
    // Debug logging function
    function debugLog(message, data = null) {
      const debugInfo = document.getElementById('debugInfo');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      
      if (data) {
        debugInfo.textContent += logEntry + '\n' + JSON.stringify(data, null, 2) + '\n\n';
      } else {
        debugInfo.textContent += logEntry + '\n';
      }
      
      debugInfo.scrollTop = debugInfo.scrollHeight;
      console.log(message, data);
    }
    
    // Show error details
    function showErrorDetails(message) {
      const errorDetails = document.getElementById('errorDetails');
      errorDetails.textContent = message;
      errorDetails.style.display = 'block';
    }
    
    // Initialize EmailJS
    async function initializeEmailJS() {
      try {
        if (!emailjs) {
          throw new Error('EmailJS not loaded');
        }
        
        debugLog('Initializing EmailJS with public key:', EMAILJS_CONFIG.publicKey);
        emailjs.init(EMAILJS_CONFIG.publicKey);
        isEmailJSInitialized = true;
        
        document.getElementById('initStatus').innerHTML = '‚úÖ EmailJS initialized successfully!';
        debugLog('EmailJS initialized successfully');
        
      } catch (error) {
        debugLog('EmailJS initialization failed:', error);
        document.getElementById('initStatus').innerHTML = '‚ùå EmailJS initialization failed: ' + error.message;
        showErrorDetails('EmailJS initialization failed: ' + error.message);
      }
    }
    
    // Function to display code with syntax highlighting
    function displayCode(code) {
      const container = document.getElementById('codeContainer');
      const emptyState = document.getElementById('emptyState');
      const codeElement = document.getElementById('generatedCode');
      
      // Hide empty state and show code container
      emptyState.style.display = 'none';
      container.style.display = 'block';
      
      // Set code content
      codeElement.textContent = code;
      
      // Apply syntax highlighting if Prism is available
      if (typeof Prism !== 'undefined') {
        codeElement.className = 'language-javascript';
        Prism.highlightElement(codeElement);
        debugLog('Syntax highlighting applied');
      } else {
        debugLog('Prism.js not available, showing plain text');
      }
    }
    
    // Copy to clipboard function
    window.copyToClipboard = function() {
      const codeElement = document.getElementById('generatedCode');
      if (codeElement) {
        const code = codeElement.textContent;
        navigator.clipboard.writeText(code).then(() => {
          const copyBtn = document.querySelector('.copy-button');
          const originalText = copyBtn.textContent;
          copyBtn.textContent = '‚úÖ Copied!';
          copyBtn.style.background = 'rgba(40, 167, 69, 0.8)';
          
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = 'rgba(255, 255, 255, 0.1)';
          }, 2000);
          
          debugLog('Code copied to clipboard');
        }).catch(err => {
          debugLog('Failed to copy code:', err);
          alert('Failed to copy code. Please select and copy manually.');
        });
      }
    };
    
    // Simple code generation
    function generateCode() {
      const codeExamples = [
        `// Random Number Generator
function generateRandomNumber() {
  return Math.floor(Math.random() * 100) + 1;
}

console.log("Random number:", generateRandomNumber());`,

        `// Color Palette Generator
const colors = ["red", "blue", "green", "yellow", "purple", "orange"];
const randomColor = colors[Math.floor(Math.random() * colors.length)];
console.log("Random color:", randomColor);`,

        `// Simple Calculator
class Calculator {
  add(a, b) {
    return a + b;
  }
  
  subtract(a, b) {
    return a - b;
  }
  
  multiply(a, b) {
    return a * b;
  }
  
  divide(a, b) {
    return b !== 0 ? a / b : "Cannot divide by zero";
  }
}

const calc = new Calculator();
console.log("5 + 3 =", calc.add(5, 3));`,

        `// Array Utilities
const arrayUtils = {
  shuffle: (arr) => {
    return arr.sort(() => Math.random() - 0.5);
  },
  
  unique: (arr) => {
    return [...new Set(arr)];
  },
  
  sum: (arr) => {
    return arr.reduce((a, b) => a + b, 0);
  }
};

const numbers = [1, 2, 3, 4, 5, 2, 3];
console.log("Original:", numbers);
console.log("Unique:", arrayUtils.unique(numbers));
console.log("Sum:", arrayUtils.sum(numbers));`
      ];
      
      return codeExamples[Math.floor(Math.random() * codeExamples.length)];
    }
    
    // Function to show feedback
    function showFeedback(message, type) {
      const feedback = document.getElementById('feedback');
      feedback.textContent = message;
      feedback.className = `feedback ${type}`;
      feedback.style.display = 'block';
      
      setTimeout(() => {
        feedback.style.display = 'none';
      }, 5000);
    }
    
    // Test email configuration
    document.getElementById('testEmailBtn').addEventListener('click', async function() {
      const button = this;
      const originalText = button.textContent;
      
      button.disabled = true;
      button.textContent = 'üîÑ Testing...';
      
      try {
        debugLog('Testing EmailJS configuration...');
        
        if (!isEmailJSInitialized) {
          await initializeEmailJS();
        }
        
        if (!emailjs) {
          throw new Error('EmailJS not available');
        }
        
        const testParams = {
          to_name: 'Test User',
          to_email: 'test@example.com',
          generated_code: 'console.log("Hello World! This is a test.");',
          from_name: 'Code Generator App',
          user_message: 'This is a test email to verify EmailJS configuration.'
        };
        
        debugLog('Sending test email with parameters:', testParams);
        
        const response = await emailjs.send(
          EMAILJS_CONFIG.serviceId, 
          EMAILJS_CONFIG.templateId, 
          testParams
        );
        
        debugLog('Test email sent successfully:', response);
        showFeedback('‚úÖ Test email sent successfully!', 'success');
        
      } catch (error) {
        debugLog('Test email failed:', error);
        
        let errorMessage = 'Test failed: ';
        if (error.status === 400) {
          errorMessage += 'Bad Request - Check your template variables';
        } else if (error.status === 401) {
          errorMessage += 'Unauthorized - Check your public key';
        } else if (error.status === 404) {
          errorMessage += 'Not Found - Check your service/template IDs';
        } else {
          errorMessage += error.message || 'Unknown error';
        }
        
        showFeedback(errorMessage, 'error');
        showErrorDetails(`Test Error Details:\nStatus: ${error.status || 'Unknown'}\nMessage: ${error.message || 'Unknown error'}\nText: ${error.text || 'No additional info'}`);
        
      } finally {
        button.disabled = false;
        button.textContent = originalText;
      }
    });
    
    // Form submission handler
    document.getElementById('codeGeneratorForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const generateBtn = document.getElementById('generateBtn');
      
      if (!name || !email) {
        showFeedback('Please fill in all fields.', 'error');
        return;
      }
      
      if (!isEmailJSInitialized || !emailjs) {
        showFeedback('EmailJS not ready. Please wait and try again.', 'error');
        return;
      }
      
      // Generate and display code
      const generatedCode = generateCode();
      displayCode(generatedCode);
      
      // Disable button and show loading state
      generateBtn.disabled = true;
      generateBtn.textContent = 'üì§ Sending Email...';
      showFeedback('Generating code and sending email...', 'info');
      
      try {
        debugLog('Starting email send process for user:', { name, email });
        
        const emailParams = {
          to_name: name,
          to_email: email,
          generated_code: generatedCode,
          from_name: 'Code Generator App',
          user_message: `Hello ${name}! Here's your freshly generated JavaScript code. Happy coding! üöÄ`
        };
        
        debugLog('Sending email with parameters:', emailParams);
        
        const response = await emailjs.send(
          EMAILJS_CONFIG.serviceId, 
          EMAILJS_CONFIG.templateId, 
          emailParams
        );
        
        debugLog('Email sent successfully:', response);
        showFeedback(`‚úÖ Success! Code generated and email sent to ${email}`, 'success');
        
        // Reset form
        this.reset();
        
      } catch (error) {
        debugLog('Email sending failed:', error);
        
        let errorMessage = 'Email sending failed: ';
        if (error.status === 400) {
          errorMessage += 'Template error - Check your EmailJS template variables';
        } else if (error.status === 401) {
          errorMessage += 'Authentication failed - Check your public key';
        } else if (error.status === 404) {
          errorMessage += 'Service/Template not found - Check your IDs';
        } else if (error.status === 429) {
          errorMessage += 'Rate limit exceeded - Please wait';
        } else {
          errorMessage += error.message || 'Unknown error';
        }
        
        showFeedback(errorMessage, 'error');
        showErrorDetails(`Email Error Details:\nStatus: ${error.status || 'Unknown'}\nMessage: ${error.message || 'Unknown error'}\nText: ${error.text || 'No additional info'}`);
        
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'üöÄ Generate Code & Send Email';
      }
    });
    
    // Toggle debug info
    document.getElementById('toggleDebug').addEventListener('click', function() {
      const debugInfo = document.getElementById('debugInfo');
      const button = this;
      
      if (debugInfo.style.display === 'none' || !debugInfo.style.display) {
        debugInfo.style.display = 'block';
        button.textContent = 'Hide Debug Info';
      } else {
        debugInfo.style.display = 'none';
        button.textContent = 'Show Debug Info';
      }
    });
    
    // Initialize on page load
    window.addEventListener('load', () => {
      debugLog('Application started');
      debugLog('EmailJS Config:', EMAILJS_CONFIG);
      initializeEmailJS();
    });
    
  </script>
</body>
</html>

